# RSS / Telegram News Aggregator Bot (aiogram 3, SQLite, FTS5)

–¢–µ–ª–µ–≥—Ä–∞–º‚Äë–±–æ—Ç –¥–ª—è –∞–≥—Ä–µ–≥–∞—Ü–∏–∏ RSS –ª–µ–Ω—Ç –Ω–µ–∑–∞–≤–∏—Å–∏–º—ã—Ö/–≤—ã–±—Ä–∞–Ω–Ω—ã—Ö –º–µ–¥–∏–∞, —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –Ω–æ–≤–æ—Å—Ç–µ–π –≤ SQLite –∏ —É–¥–æ–±–Ω–æ–π –Ω–∞–≤–∏–≥–∞—Ü–∏–∏ / –ø–æ–ª–Ω–æ—Ç–µ–∫—Å—Ç–æ–≤–æ–≥–æ –ø–æ–∏—Å–∫–∞ (—Å –ª–æ–≥–∏—á–µ—Å–∫–∏–º–∏ –æ–ø–µ—Ä–∞—Ç–æ—Ä–∞–º–∏).  
–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è:
- –•—Ä–∞–Ω–µ–Ω–∏–µ –Ω–æ–≤–æ—Å—Ç–µ–π –≤ SQLite —Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π FTS5 –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–π —Ç–∞–±–ª–∏—Ü–µ–π.
- –ü–æ–∏—Å–∫ c –æ–ø–µ—Ä–∞—Ç–æ—Ä–∞–º–∏: `AND OR NOT`, –∞ —Ç–∞–∫–∂–µ –∫—Ä–∞—Ç–∫–∏–π —Å–∏–Ω—Ç–∞–∫—Å–∏—Å `+word` (=AND), `-word` (=NOT), `|word` (=OR), —Ñ—Ä–∞–∑—ã –≤ –∫–∞–≤—ã—á–∫–∞—Ö `"multi word"`.
- –ü—Ä–æ—Å–º–æ—Ç—Ä —Å–ø–∏—Å–∫–∞ –ø–æ—Å–ª–µ–¥–Ω–∏—Ö –Ω–æ–≤–æ—Å—Ç–µ–π (/latest) –∏ –ø–æ—à—Ç—É—á–Ω–∞—è –Ω–∞–≤–∏–≥–∞—Ü–∏—è (/news).
- –ó–∞—â–∏—Ç–∞ –æ—Ç HTML/—Ä–∞–∑–º–µ—Ç–æ—á–Ω—ã—Ö –æ—à–∏–±–æ–∫: –≤—Å–µ –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–µ –ø–æ–ª—è —ç–∫—Ä–∞–Ω–∏—Ä—É—é—Ç—Å—è.
- –ê–≤—Ç–æ—Å–±–æ—Ä —Ñ–∏–¥–æ–≤ –ø–æ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—é + —Ä—É—á–Ω–æ–π –∑–∞–ø—É—Å–∫.
- –ü–∞–≥–∏–Ω–∞—Ü–∏—è —Å inline‚Äë–∫–Ω–æ–ø–∫–∞–º–∏ –∏ callback'–∞–º–∏.
- Fallback: –µ—Å–ª–∏ FTS5 –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω ‚Äî –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –±–µ–∑–æ–ø–∞—Å–Ω—ã–π SQL LIKE.

---

## –°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ
1. [–ö–æ–º–∞–Ω–¥—ã –±–æ—Ç–∞](#–∫–æ–º–∞–Ω–¥—ã-–±–æ—Ç–∞)
2. [–ü–æ–∏—Å–∫ –∏ —Å–∏–Ω—Ç–∞–∫—Å–∏—Å –∑–∞–ø—Ä–æ—Å–æ–≤](#–ø–æ–∏—Å–∫-–∏-—Å–∏–Ω—Ç–∞–∫—Å–∏—Å-–∑–∞–ø—Ä–æ—Å–æ–≤)
3. [–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –∏ —Ñ–∞–π–ª—ã](#–∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞-–∏-—Ñ–∞–π–ª—ã)
4. [–£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ –∑–∞–ø—É—Å–∫](#—É—Å—Ç–∞–Ω–æ–≤–∫–∞-–∏-–∑–∞–ø—É—Å–∫)
5. [–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è (config.toml)](#–∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è)
6. [–ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è](#–ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ-–æ–∫—Ä—É–∂–µ–Ω–∏—è)
7. [–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –∏ FTS5](#–±–∞–∑–∞-–¥–∞–Ω–Ω—ã—Ö-–∏-fts5)
8. [–≠–∫—Ä–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å](#—ç–∫—Ä–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ-–∏-–±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å)
9. [–ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ–∏—Å–∫–∞](#–∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ-–ø–æ–∏—Å–∫–∞)
10. [–ü–ª–∞–Ω—ã –∏ —É–ª—É—á—à–µ–Ω–∏—è](#–ø–ª–∞–Ω—ã-–∏-—É–ª—É—á—à–µ–Ω–∏—è)
11. [–û—Ç–ª–∞–¥–∫–∞](#–æ—Ç–ª–∞–¥–∫–∞)
12. [–ö—Ä–∞—Ç–∫–∞—è –∞–Ω–≥–ª–∏–π—Å–∫–∞—è —Å–≤–æ–¥–∫–∞ (optional)](#english-summary)

---

## –ö–æ–º–∞–Ω–¥—ã –±–æ—Ç–∞

| –ö–æ–º–∞–Ω–¥–∞ | –û–ø–∏—Å–∞–Ω–∏–µ |
|--------|----------|
| `/start`, `/help` | –ö—Ä–∞—Ç–∫–∞—è —Å–ø—Ä–∞–≤–∫–∞ –∏ —Å–ø–∏—Å–æ–∫ –∫–æ–º–∞–Ω–¥. |
| `/latest` | –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Å—Ä–∞–∑—É —Å–ø–∏—Å–æ–∫ –ø–æ—Å–ª–µ–¥–Ω–∏—Ö N –Ω–æ–≤–æ—Å—Ç–µ–π (—á–∏—Å–ª–æ –∑–∞–¥–∞—ë—Ç—Å—è –≤ `pagination.latest_count`). –° –ø–∞–≥–∏–Ω–∞—Ü–∏–µ–π –ø–æ —Å—Ç—Ä–∞–Ω–∏—Ü–∞–º (—á–µ—Ä–µ–∑ callback-–∫–Ω–æ–ø–∫–∏). |
| `/news [N]` | –ü–æ—Å—Ç—Ä–∞–Ω–∏—á–Ω—ã–π (—Ç–æ—á–µ—á–Ω—ã–π) –ø—Ä–æ—Å–º–æ—Ç—Ä –ø–æ –æ–¥–Ω–æ–π –Ω–æ–≤–æ—Å—Ç–∏. –ê—Ä–≥—É–º–µ–Ω—Ç N (1-based) ‚Äî —Å—Ç–∞—Ä—Ç–æ–≤–∞—è –ø–æ–∑–∏—Ü–∏—è, –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 1 (—Å–∞–º–∞—è —Å–≤–µ–∂–∞—è). –ö–Ω–æ–ø–∫–∏: ¬´‚èÆ –ü–µ—Ä–≤.¬ª ¬´¬´ –ü—Ä–µ–¥¬ª, ¬´–°–ª–µ–¥ ¬ª ¬´–ü–æ—Å–ª. ‚è≠¬ª, ¬´‚úñ –ó–∞–∫—Ä—ã—Ç—å¬ª, –∏ –æ—Ç–¥–µ–ª—å–Ω–∞—è –∫–Ω–æ–ø–∫–∞ ¬´üîó –ü–µ—Ä–µ–π—Ç–∏¬ª. |
| `/filter <–∑–∞–ø—Ä–æ—Å>` | –ü–æ–ª–Ω–æ—Ç–µ–∫—Å—Ç–æ–≤—ã–π –ø–æ–∏—Å–∫ –ø–æ –∑–∞–≥–æ–ª–æ–≤–∫—É –∏ summary. –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –ª–æ–≥–∏—á–µ—Å–∫–∏–µ –æ–ø–µ—Ä–∞—Ç–æ—Ä—ã –∏ —Å–∏–Ω—Ç–∞–∫—Å–∏—Å (—Å–º. –Ω–∏–∂–µ). –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Å –ø–∞–≥–∏–Ω–∞—Ü–∏–µ–π –∏ –∫–Ω–æ–ø–∫–∞–º–∏ –ø–µ—Ä–µ—Ö–æ–¥–∞. |
| `/stats` | –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤—É –Ω–æ–≤–æ—Å—Ç–µ–π –ø–æ –∏—Å—Ç–æ—á–Ω–∏–∫–∞–º. |
| `/fetch` | –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω—ã–π —Å–±–æ—Ä –≤—Å–µ—Ö RSS (–¥–æ—Å—Ç—É–ø–Ω–æ —Ç–æ–ª—å–∫–æ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—É ‚Äî chat_id –∏–∑ –∫–æ–Ω—Ñ–∏–≥–∞). |

–í—Å–µ —Å–ø–∏—Å–∫–æ–≤—ã–µ —Ä–µ–∂–∏–º—ã –∏–º–µ—é—Ç –∫–Ω–æ–ø–∫—É ¬´‚úñ –ó–∞–∫—Ä—ã—Ç—å¬ª, —É–±–∏—Ä–∞—é—â—É—é inline‚Äë–∫–ª–∞–≤–∏–∞—Ç—É—Ä—É.

---

## –ü–æ–∏—Å–∫ –∏ —Å–∏–Ω—Ç–∞–∫—Å–∏—Å –∑–∞–ø—Ä–æ—Å–æ–≤

–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è (—Ä–µ–≥–∏—Å—Ç—Ä –Ω–µ –≤–∞–∂–µ–Ω):

| –ü—Ä–∏–º–µ—Ä | –ó–Ω–∞—á–µ–Ω–∏–µ |
|--------|---------|
| `—Å–ª–æ–≤–æ` | –ü–æ–∏—Å–∫ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤, –≥–¥–µ –≤—Å—Ç—Ä–µ—á–∞–µ—Ç—Å—è `—Å–ª–æ–≤–æ`. –ü—Ä–æ–±–µ–ª—ã –º–µ–∂–¥—É —Å–ª–æ–≤–∞–º–∏ = `AND`. |
| `—Å–ª–æ–≤–æ1 —Å–ª–æ–≤–æ2` | –≠–∫–≤–∏–≤–∞–ª–µ–Ω—Ç `—Å–ª–æ–≤–æ1 AND —Å–ª–æ–≤–æ2`. |
| `—Å–ª–æ–≤–æ1 OR —Å–ª–æ–≤–æ2` | –õ–æ–≥–∏—á–µ—Å–∫–æ–µ –ò–õ–ò. |
| `—Å–ª–æ–≤–æ1 AND —Å–ª–æ–≤–æ2` | –õ–æ–≥–∏—á–µ—Å–∫–æ–µ –ò (—è–≤–Ω–æ–µ). |
| `NOT —Å–ª–æ–≤–æ` / `-—Å–ª–æ–≤–æ` | –ò—Å–∫–ª—é—á–∏—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç—ã, —Å–æ–¥–µ—Ä–∂–∞—â–∏–µ —Å–ª–æ–≤–æ. |
| `+–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ–µ` | –û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–π —Ç–µ—Ä–º–∏–Ω (—ç–∫–≤–∏–≤–∞–ª–µ–Ω—Ç AND —Å –æ—Å—Ç–∞–ª—å–Ω—ã–º–∏). |
| `|–≤–∞—Ä–∏–∞–Ω—Ç` | –î–æ–±–∞–≤–∏—Ç—å —Ç–µ—Ä–º–∏–Ω —á–µ—Ä–µ–∑ OR. |
| `"—Ç–æ—á–Ω–∞—è —Ñ—Ä–∞–∑–∞"` | –ü–æ–∏—Å–∫ —Ç–æ—á–Ω–æ–π —Ñ—Ä–∞–∑—ã. |
| `—Å–ª–æ–≤–æ1 OR "—Ç–æ—á–Ω–∞—è —Ñ—Ä–∞–∑–∞" -–º–∏–Ω—É—Å` | –ö–æ–º–±–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –∑–∞–ø—Ä–æ—Å. |

–ü–∞—Ä—Å–µ—Ä:
- –ü–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω—ã–µ —Ç–µ—Ä–º—ã –±–µ–∑ –æ–ø–µ—Ä–∞—Ç–æ—Ä–∞ -> `AND`.
- –¶–µ–ø–æ—á–∫–∏ –ø–æ–≤—Ç–æ—Ä—è—é—â–∏—Ö—Å—è –æ–ø–µ—Ä–∞—Ç–æ—Ä–æ–≤ —Å—Ö–ª–æ–ø—ã–≤–∞—é—Ç—Å—è.
- –°–∫–æ–±–∫–∏ `( )` –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç—Å—è (–æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ FTS5 —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –∏ —É–ø—Ä–æ—â—ë–Ω–Ω—ã–π –ø–∞—Ä—Å–µ—Ä).
- FTS5: –∑–∞–ø—Ä–æ—Å –∫–æ–º–ø–∏–ª–∏—Ä—É–µ—Ç—Å—è –≤ –≤—ã—Ä–∞–∂–µ–Ω–∏–µ MATCH.  
- Fallback (LIKE): –ª–æ–≥–∏—á–µ—Å–∫–∏–π AST —Ç—Ä–∞–Ω—Å–ª–∏—Ä—É–µ—Ç—Å—è –≤ WHERE —Å `lower(title) LIKE ? OR lower(summary) LIKE ?`.

> –ü—Ä–∏–º–µ—á–∞–Ω–∏–µ: –¥–ª—è FTS5 –º–æ–∂–Ω–æ –ø–æ–∑–∂–µ —Ä–∞—Å—à–∏—Ä–∏—Ç—å –ø–æ–¥–¥–µ—Ä–∂–∫—É `NEAR/5`, —Å—É—Ñ—Ñ–∏–∫—Å–Ω—ã—Ö `*` –∏ –ø—Ä.

---

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –∏ —Ñ–∞–π–ª—ã

| –§–∞–π–ª | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ |
|------|------------|
| `main.py` | –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞. –ß–∏—Ç–∞–µ—Ç –∫–æ–Ω—Ñ–∏–≥, –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ—Ç –ë–î, –±–æ—Ç–∞, –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫, –∑–∞–ø—É—Å–∫–∞–µ—Ç polling. |
| `db.py` | –ö–ª–∞—Å—Å `Database`: —Å—Ö–µ–º–∞ —Ç–∞–±–ª–∏—Ü, FTS5 –≤–∏—Ä—Ç—É–∞–ª—å–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞ `news_fts`, —Ç—Ä–∏–≥–≥–µ—Ä—ã —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏, –º–µ—Ç–æ–¥—ã –≤—Å—Ç–∞–≤–∫–∏ –∏ –ø–æ–∏—Å–∫–∞. |
| `bot_commands.py` | –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –≤—Å–µ—Ö —Ö—ç–Ω–¥–ª–µ—Ä–æ–≤ (`/start`, `/help`, `/latest`, `/news`, `/filter`, `/stats`, `/fetch`), —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç–µ–∫—Å—Ç–æ–≤ –∏ –∏–Ω–ª–∞–π–Ω-–∫–ª–∞–≤–∏–∞—Ç—É—Ä. –≠–∫—Ä–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –æ—á–∏—Å—Ç–∫–∞ —Ç–µ–∫—Å—Ç–∞. |
| `search_parser.py` | –ü–∞—Ä—Å–µ—Ä –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–≥–æ –∑–∞–ø—Ä–æ—Å–∞ -> AST (Term, AndNode, OrNode, NotNode) + –≥–µ–Ω–µ—Ä–∞—Ü–∏—è FTS –≤—ã—Ä–∞–∂–µ–Ω–∏—è –∏ SQL LIKE —É—Å–ª–æ–≤–∏–π. |
| `fetcher.py` | –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π —Å–±–æ—Ä RSS (–Ω–µ –ø–æ–∫–∞–∑–∞–Ω –≤—ã—à–µ ‚Äî –ø—Ä–µ–¥–ø–æ–ª–∞–≥–∞–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `aiohttp` / `feedparser`). –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –Ω–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã. |
| `feeds.py` | –°–ª–æ–≤–∞—Ä—å –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤ RSS (`FEEDS`). |
| `scheduler.py` | –ü–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ –ø–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–æ–≥–æ –∑–∞–ø—É—Å–∫–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä —á–µ—Ä–µ–∑ `asyncio.create_task` + sleep / APScheduler). |
| `config.example.toml` | –ü—Ä–∏–º–µ—Ä –Ω–∞—Å—Ç—Ä–æ–µ–∫. |
| `requirements.txt` (–ø—Ä–µ–¥–ø–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω–æ) | –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –ø—Ä–æ–µ–∫—Ç–∞. |

---

## –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ –∑–∞–ø—É—Å–∫

### 1. –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è
- Python 3.11+ (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –∏–∑-–∑–∞ –ø–æ–¥–¥–µ—Ä–∂–∫–∏ —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö async –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–µ–π).
- SQLite —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π FTS5 (–æ–±—ã—á–Ω–æ –≤—Å—Ç—Ä–æ–µ–Ω–æ –≤ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ —Å–±–æ—Ä–∫–∏ Python 3.11+). –ü—Ä–æ–≤–µ—Ä–∏—Ç—å:
  ```python
  import sqlite3; print(sqlite3.sqlite_version)
  ```
  –í–µ—Ä—Å–∏—è ‚â• 3.9.0. –î–ª—è —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç–∏ –∂–µ–ª–∞—Ç–µ–ª—å–Ω–æ 3.35+.

### 2. –ö–ª–æ–Ω–∏—Ä–æ–≤–∞—Ç—å —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π
```bash
git clone https://github.com/your-org/your-repo.git
cd your-repo
```

### 3. –í–∏—Ä—Ç—É–∞–ª—å–Ω–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ –∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
```bash
python -m venv .venv
source .venv/bin/activate  # Windows: .venv\Scripts\activate
pip install -U pip
pip install -r requirements.txt
```

–ü—Ä–∏–º–µ—Ä `requirements.txt` (–∞–¥–∞–ø—Ç–∏—Ä—É–π—Ç–µ):
```
aiogram==3.*
aiohttp>=3.9
toml
feedparser
```

### 4. –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –∫–æ–Ω—Ñ–∏–≥
–°–∫–æ–ø–∏—Ä—É–π—Ç–µ –ø—Ä–∏–º–µ—Ä:
```bash
cp config.example.toml config.toml
```
–û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ —Ç–æ–∫–µ–Ω –±–æ—Ç–∞ Telegram –∏ chat_id.

### 5. –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
–ú–æ–∂–Ω–æ –ø–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å:
- `BOT_TOKEN`
- `CHAT_ID`
- `DB_PATH`

–ï—Å–ª–∏ –∑–∞–¥–∞–Ω—ã, –ø–µ—Ä–µ–∫—Ä—ã–≤–∞—é—Ç –∑–Ω–∞—á–µ–Ω–∏—è –≤ `config.toml`.

### 6. –ó–∞–ø—É—Å–∫
```bash
python main.py
```

–ü—Ä–∏ —Å—Ç–∞—Ä—Ç–µ:
- –í—ã–ø–æ–ª–Ω–∏—Ç—Å—è –ø–µ—Ä–≤—ã–π —Å–±–æ—Ä —Ñ–∏–¥–æ–≤.
- –û—Ç–ø—Ä–∞–≤–∏—Ç—Å—è —Å–æ–æ–±—â–µ–Ω–∏–µ –æ –Ω–æ–≤—ã—Ö –Ω–∞–π–¥–µ–Ω–Ω—ã—Ö –Ω–æ–≤–æ—Å—Ç—è—Ö (–µ—Å–ª–∏ –ø–æ—è–≤–∏–ª–∏—Å—å).
- –ë–æ—Ç –Ω–∞—á–Ω—ë—Ç polling.

---

## –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

–§—Ä–∞–≥–º–µ–Ω—Ç `config.example.toml`:

```toml
[database]
path = "news.db"

[telegram]
bot_token = "PUT_YOUR_TOKEN_HERE"
chat_id = "PUT_CHAT_OR_USER_ID_HERE"

[scheduler]
fetch_interval_minutes = 60

[fetch]
batch_limit_per_feed = 0          # 0 = –±–µ–∑ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è
timeout_seconds = 20
user_agent = "RSSBotAiogram/1.0 (+https://example.org)"

[pagination]
page_size = 10                    # –¥–ª—è —Å–ø–∏—Å–∫–æ–≤ (/latest)
search_page_size = 10             # –¥–ª—è /filter (–µ—Å–ª–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç -> page_size)
latest_count = 10                 # —á–∏—Å–ª–æ –Ω–æ–≤–æ—Å—Ç–µ–π –≤ /latest (—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Å–ø–∏—Å–æ–∫)
```

–ü–æ—è—Å–Ω–µ–Ω–∏—è:
- `page_size` ‚Äî —Ä–∞–∑–º–µ—Ä —Å—Ç—Ä–∞–Ω–∏—Ü—ã –≤ —Å–ø–∏—Å–∫–∞—Ö `/latest`.
- `latest_count` ‚Äî —Å–∫–æ–ª—å–∫–æ –ø–æ—Å–ª–µ–¥–Ω–∏—Ö –Ω–æ–≤–æ—Å—Ç–µ–π –≤—ã–≤–æ–¥–∏—Ç—å –æ–¥–Ω–æ–π –∫–æ–º–∞–Ω–¥–æ–π `/latest` (—Å–ø–∏—Å–∫–æ–º).
- `search_page_size` ‚Äî —Ä–∞–∑–º–µ—Ä —Å—Ç—Ä–∞–Ω–∏—Ü —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –ø–æ–∏—Å–∫–∞.
- `fetch_interval_minutes` ‚Äî –ø–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∏–π —Å–±–æ—Ä —Ñ–∏–¥–æ–≤.

---

## –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

| –ò–º—è | –û–ø–∏—Å–∞–Ω–∏–µ |
|-----|----------|
| `BOT_TOKEN` | –¢–æ–∫–µ–Ω Telegram Bot API. |
| `CHAT_ID` | ID —á–∞—Ç–∞/–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –¥–ª—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –∏ –∫–æ–Ω—Ç—Ä–æ–ª—è. |
| `DB_PATH` | –ü—É—Ç—å –∫ SQLite —Ñ–∞–π–ª—É (–ø–µ—Ä–µ–∫—Ä—ã–≤–∞–µ—Ç `database.path`). |

---

## –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –∏ FTS5

–û—Å–Ω–æ–≤–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞:
```sql
CREATE TABLE news (
  id INTEGER PRIMARY KEY AUTOINCREMENT,
  source TEXT,
  title TEXT,
  link TEXT,
  published TEXT,
  summary TEXT,
  hash TEXT UNIQUE,
  added_at TEXT DEFAULT (datetime('now'))
);
```

–ò–Ω–¥–µ–∫—Å—ã –ø–æ `published`, `source`.

FTS5 –≤–∏—Ä—Ç—É–∞–ª—å–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞:
```sql
CREATE VIRTUAL TABLE news_fts USING fts5(
  title, summary, content='news', content_rowid='id'
);
```

–¢—Ä–∏–≥–≥–µ—Ä—ã:
- `AFTER INSERT` ‚Äî —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É–µ—Ç –Ω–æ–≤—É—é –∑–∞–ø–∏—Å—å.
- `AFTER UPDATE` ‚Äî –ø–µ—Ä–µ–∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç —Å—Ç—Ä–æ–∫—É –≤ FTS.
- `AFTER DELETE` ‚Äî –ø–æ–º–µ—á–∞–µ—Ç —É–¥–∞–ª–µ–Ω–∏–µ.

Fallback:
- –ï—Å–ª–∏ –ø—Ä–∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –≤–æ–∑–Ω–∏–∫–∞–µ—Ç –æ—à–∏–±–∫–∞ `no such module: fts5`, —Ñ–ª–∞–≥ `_fts_available = False`, –∏ –ø–æ–∏—Å–∫ —Å–≤–æ–¥–∏—Ç—Å—è –∫ SQL LIKE.

---

## –≠–∫—Ä–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

–ü–æ—á–µ–º—É –≤–∞–∂–Ω–æ:
- –í Telegram –ø—Ä–∏ `parse_mode=HTML` –Ω–µ–ª—å–∑—è –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å –Ω–µ–æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã–µ `<`, `>`, `&`.
- RSS/–≤–≤–æ–¥ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –º–æ–∂–µ—Ç —Å–æ–¥–µ—Ä–∂–∞—Ç—å HTML/—Å–∫—Ä–∏–ø—Ç—ã.

–ú–µ—Ö–∞–Ω–∏–∑–º:
- –§—É–Ω–∫—Ü–∏—è `clean_text()`:
  1. `html.unescape` ‚Äî –¥–µ–∫–æ–¥–∏—Ä—É–µ—Ç —Å—É—â–Ω–æ—Å—Ç–∏.
  2. –£–¥–∞–ª—è–µ—Ç –≤—Å–µ HTML‚Äë—Ç–µ–≥–∏.
  3. –ó–∞–º–µ–Ω—è–µ—Ç –ø–∞—Ç—Ç–µ—Ä–Ω—ã –≤–∏–¥–∞ `[&#8230;]` –Ω–∞ `‚Ä¶`.
  4. –ù–æ—Ä–º–∞–ª–∏–∑—É–µ—Ç –ø—Ä–æ–±–µ–ª—ã / –ø–µ—Ä–µ–Ω–æ—Å—ã.
  5. –ü–æ–≤—Ç–æ—Ä–Ω–æ —ç–∫—Ä–∞–Ω–∏—Ä—É–µ—Ç (`html.escape`) –ø–µ—Ä–µ–¥ –æ—Ç–ø—Ä–∞–≤–∫–æ–π.

–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ: –ï—Å–ª–∏ –≤—ã –∑–∞—Ö–æ—Ç–∏—Ç–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å MarkdownV2 ‚Äî –ø—Ä–∏–¥—ë—Ç—Å—è –∞–¥–∞–ø—Ç–∏—Ä–æ–≤–∞—Ç—å —ç–∫—Ä–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ–¥ –µ–≥–æ –ø—Ä–∞–≤–∏–ª–∞.

---

## –ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ–∏—Å–∫–∞

`SEARCH_CACHE`:
- –ö–ª—é—á: –ø–µ—Ä–≤—ã–µ 8 —Å–∏–º–≤–æ–ª–æ–≤ SHA1 –æ—Ç –Ω–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–≥–æ –∑–∞–ø—Ä–æ—Å–∞.
- –ó–Ω–∞—á–µ–Ω–∏–µ: –Ω–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–π –∏—Å—Ö–æ–¥–Ω—ã–π –∑–∞–ø—Ä–æ—Å (lowercase).
- –•—Ä–∞–Ω–∏—Ç—Å—è –≤ –ø–∞–º—è—Ç–∏ –ø—Ä–æ—Ü–µ—Å—Å–∞ (–ø–æ—Å–ª–µ —Ä–µ—Å—Ç–∞—Ä—Ç–∞ ‚Äî –æ—á–∏—â–∞–µ—Ç—Å—è).
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –∫–æ–º–ø–∞–∫—Ç–Ω–æ–≥–æ `callback_data` –ø—Ä–∏ –ø–∞–≥–∏–Ω–∞—Ü–∏–∏ –ø–æ–∏—Å–∫–∞.

–†–∞—Å—à–∏—Ä–µ–Ω–∏—è (–Ω–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ):
- TTL / LRU –æ—á–∏—Å—Ç–∫–∞.
- –ü–µ—Ä—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å –≤ –æ—Ç–¥–µ–ª—å–Ω–æ–π —Ç–∞–±–ª–∏—Ü–µ.

---

## –ü–ª–∞–Ω—ã –∏ —É–ª—É—á—à–µ–Ω–∏—è

–ü–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–µ next steps:

| –ù–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ | –ò–¥–µ—è |
|-------------|------|
| UI | –ü–æ–¥—Å–≤–µ—Ç–∫–∞ —Ç–µ—Ä–º–∏–Ω–æ–≤ –ø–æ–∏—Å–∫–∞ (`<b>...</b>`), —Ñ–∏–ª—å—Ç—Ä –ø–æ –∏—Å—Ç–æ—á–Ω–∏–∫—É. |
| –ü–æ–∏—Å–∫ | –ü–æ–¥–¥–µ—Ä–∂–∫–∞ `NEAR/5`, —Å—É—Ñ—Ñ–∏–∫—Å–Ω—ã—Ö `*` (–ø—Ä–µ—Ñ–∏–∫—Å–Ω—ã–π –ø–æ–∏—Å–∫), –ª–∏–º–∏—Ç –≥–ª—É–±–∏–Ω—ã. |
| –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å | –ö—ç—à –ø–æ—Å–ª–µ–¥–Ω–∏—Ö N –≤—ã–±–æ—Ä–æ–∫ –≤ –ø–∞–º—è—Ç–∏; batched –≤—Å—Ç–∞–≤–∫–∏ (—É–∂–µ –µ—Å—Ç—å), —Å–∂–∞—Ç–∏–µ summary. |
| DevOps | Dockerfile, health‚Äëcheck endpoint, logging –≤ —Ñ–∞–π–ª—ã / —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π JSON. |
| –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ | /removeold (—É–¥–∞–ª–µ–Ω–∏–µ –Ω–æ–≤–æ—Å—Ç–µ–π —Å—Ç–∞—Ä—à–µ X –¥–Ω–µ–π), /sources. |
| –õ–æ–∫–∞–ª–∏–∑–∞—Ü–∏—è | –ë–∏–ª–∏–Ω–≥–≤–∞–ª—å–Ω–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞ (RU/EN) —á–µ—Ä–µ–∑ —Å–ª–æ–≤–∞—Ä—å. |
| –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å | –í–∞–ª–∏–¥–∞—Ü–∏—è feed URL –∏–∑ —Å–ø–∏—Å–∫–∞ whitelist, rate limit –∫–æ–º–∞–Ω–¥. |
| UX | –ö–Ω–æ–ø–∫–∞ "–û–±–Ω–æ–≤–∏—Ç—å" –≤ –æ–¥–∏–Ω–æ—á–Ω–æ–º –ø—Ä–æ—Å–º–æ—Ç—Ä–µ /news. |

---

## –û—Ç–ª–∞–¥–∫–∞

1. –û—à–∏–±–∫–∞ `Bad Request: can't parse entities`:  
   - –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —ç–∫—Ä–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ `< > &`.
2. –û—à–∏–±–∫–∞ `no such module: fts5`:  
   - –û–±–Ω–æ–≤–∏—Ç–µ SQLite / Python. –ò–Ω–∞—á–µ –±—É–¥–µ—Ç fallback ‚Äî —ç—Ç–æ –Ω–æ—Ä–º–∞–ª—å–Ω–æ, –Ω–æ –ø–æ–∏—Å–∫ –º–µ–¥–ª–µ–Ω–Ω–µ–µ.
3. –ü—É—Å—Ç—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–æ–∏—Å–∫–∞:  
   - –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –∑–∞–ø—Ä–æ—Å –Ω–µ –æ—á–∏—â–∞–µ—Ç—Å—è –ø–æ–ª–Ω–æ—Å—Ç—å—é –ø–∞—Ä—Å–µ—Ä–æ–º (–Ω–∞–ø—Ä–∏–º–µ—Ä, —Ç–æ–ª—å–∫–æ —Å–ø–µ—Ü—Å–∏–º–≤–æ–ª—ã).
4. –î—É–±–ª–∏–∫–∞—Ç—ã –Ω–µ –≤—Å—Ç–∞–≤–ª—è—é—Ç—Å—è:  
   - –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ —É–Ω–∏–∫–∞–ª—å–Ω–æ–º—É `hash` (—Ñ–æ—Ä–º–∏—Ä—É–π—Ç–µ —Ö—ç—à –∏–∑ –∫–æ–º–±–∏–Ω–∞—Ü–∏–∏ (`link`, `title`), —Å–º. –≤–∞—à fetcher).
5. –ó–∞–º–µ–¥–ª–µ–Ω–∏–µ –ø—Ä–∏ –±–æ–ª—å—à–æ–º –æ–±—ä—ë–º–µ:  
   - –î–æ–±–∞–≤—å—Ç–µ –ª–∏–º–∏—Ç –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–≥–æ —Å–º–µ—â–µ–Ω–∏—è (`OFFSET`), –∞—Ä—Ö–∏–≤–∏—Ä—É–π—Ç–µ —Å—Ç–∞—Ä—ã–µ –∑–∞–ø–∏—Å–∏ –≤ –æ—Ç–¥–µ–ª—å–Ω—É—é –ë–î.

–õ–æ–∫–∞–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ FTS:
```python
from db import Database
db = Database("news.db")
print("FTS available:", db._fts_available)
```

---

## English Summary

This Telegram bot aggregates RSS feeds into a SQLite database, provides FTS5 full‚Äëtext search with logical operators (AND/OR/NOT, prefix syntax + / - / |, quoted phrases), and offers both list (/latest) and single‚Äëitem (/news) navigation views. It gracefully falls back to LIKE queries if FTS5 is unavailable, escapes all dynamic text to avoid Telegram HTML parse errors, and caches search queries for pagination. Extendable via additional commands, highlighting, NEAR queries, and Dockerization.

---

## –õ–∏—Ü–µ–Ω–∑–∏—è

(–£–∫–∞–∂–∏—Ç–µ –ª–∏—Ü–µ–Ω–∑–∏—é ‚Äî –Ω–∞–ø—Ä–∏–º–µ—Ä MIT / Apache-2.0 ‚Äî –µ—Å–ª–∏ —Ç—Ä–µ–±—É–µ—Ç—Å—è.)

---

–ì–æ—Ç–æ–≤–æ. –ï—Å–ª–∏ –Ω—É–∂–Ω–∞ –≤–µ—Ä—Å–∏—è –Ω–∞ –∞–Ω–≥–ª–∏–π—Å–∫–æ–º —Ü–µ–ª–∏–∫–æ–º, Dockerfile, requirements.txt –∏–ª–∏ –ø–æ–¥—Å–≤–µ—Ç–∫–∞ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–π –≤ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞—Ö –ø–æ–∏—Å–∫–∞ ‚Äî –¥–∞–π—Ç–µ –∑–Ω–∞—Ç—å.